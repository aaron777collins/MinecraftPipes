// test_setup.mdl - Test setup for Minecraft Pipes
// This file contains functions to set up a test pipe network

namespace "pipes";

// Set up a complete test pipe network
function "test_setup" {
    say "Setting up test pipe network...";
    
    // Create source chest with items
    setblock ~ ~ ~ minecraft:chest;
    data modify block ~ ~ ~ Items set value [{id:"minecraft:stone",Count:64b,Slot:0b},{id:"minecraft:dirt",Count:32b,Slot:1b},{id:"minecraft:oak_log",Count:16b,Slot:2b}];
    
    // Create inlet pipe
    execute positioned ~ ~ ~+1 run function "pipes:create_inlet_pipe";
    
    // Create basic pipes in a line
    execute positioned ~ ~ ~+2 run function "pipes:create_pipe";
    execute positioned ~ ~ ~+3 run function "pipes:create_pipe";
    execute positioned ~ ~ ~+4 run function "pipes:create_pipe";
    
    // Create outlet pipe
    execute positioned ~ ~ ~+5 run function "pipes:create_outlet_pipe";
    
    // Create destination chest
    execute positioned ~ ~ ~+6 run setblock ~ ~ ~ minecraft:chest;
    
    // Create redstone power source
    execute positioned ~ ~ ~+1 run setblock ~ ~+1 ~ minecraft:redstone_block;
    
    say "Test pipe network created!";
    say "Source chest at current position";
    say "Inlet pipe at ~ ~ ~+1";
    say "Basic pipes at ~ ~ ~+2, ~ ~ ~+3, ~ ~ ~+4";
    say "Outlet pipe at ~ ~ ~+5";
    say "Destination chest at ~ ~ ~+6";
    say "Redstone power at ~ ~+1 ~+1";
    say "Use /function pipes:debug_pipe to see pipe information";
}

// Set up a more complex test with branching
function "test_setup_complex" {
    say "Setting up complex test pipe network...";
    
    // Create source chest
    setblock ~ ~ ~ minecraft:chest;
    data modify block ~ ~ ~ Items set value [{id:"minecraft:stone",Count:64b,Slot:0b},{id:"minecraft:dirt",Count:32b,Slot:1b}];
    
    // Create inlet pipe
    execute positioned ~ ~ ~+1 run function "pipes:create_inlet_pipe";
    
    // Create pipe junction
    execute positioned ~ ~ ~+2 run function "pipes:create_pipe";
    
    // Create branch 1 (left)
    execute positioned ~-1 ~ ~+2 run function "pipes:create_pipe";
    execute positioned ~-1 ~ ~+3 run function "pipes:create_outlet_pipe";
    execute positioned ~-1 ~ ~+4 run setblock ~ ~ ~ minecraft:chest;
    
    // Create branch 2 (right)
    execute positioned ~+1 ~ ~+2 run function "pipes:create_pipe";
    execute positioned ~+1 ~ ~+3 run function "pipes:create_outlet_pipe";
    execute positioned ~+1 ~ ~+4 run setblock ~ ~ ~ minecraft:chest;
    
    // Create branch 3 (forward)
    execute positioned ~ ~ ~+3 run function "pipes:create_pipe";
    execute positioned ~ ~ ~+4 run function "pipes:create_outlet_pipe";
    execute positioned ~ ~ ~+5 run setblock ~ ~ ~ minecraft:chest;
    
    // Create redstone power
    execute positioned ~ ~ ~+1 run setblock ~ ~+1 ~ minecraft:redstone_block;
    
    say "Complex test pipe network created!";
    say "Source chest at current position";
    say "Junction at ~ ~ ~+2";
    say "Three destination chests at ~-1 ~ ~+4, ~+1 ~ ~+4, ~ ~ ~+5";
}

// Clean up test setup
function "test_cleanup" {
    say "Cleaning up test pipe network...";
    
    // Remove all pipe blocks in a 10x10x10 area
    fill ~-5 ~-5 ~-5 ~+5 ~+5 ~+5 minecraft:air replace minecraft:glass;
    fill ~-5 ~-5 ~-5 ~+5 ~+5 ~+5 minecraft:air replace minecraft:red_stained_glass;
    fill ~-5 ~-5 ~-5 ~+5 ~+5 ~+5 minecraft:air replace minecraft:blue_stained_glass;
    fill ~-5 ~-5 ~-5 ~+5 ~+5 ~+5 minecraft:air replace minecraft:yellow_stained_glass;
    
    // Remove chests
    fill ~-5 ~-5 ~-5 ~+5 ~+5 ~+5 minecraft:air replace minecraft:chest;
    
    // Remove redstone blocks
    fill ~-5 ~-5 ~-5 ~+5 ~+5 ~+5 minecraft:air replace minecraft:redstone_block;
    
    // Kill pipe entities
    kill @e[type=minecraft:marker,tag=pipe_block];
    kill @e[type=minecraft:item,tag=pipe_item];
    
    say "Test cleanup complete!";
}

// Show test instructions
function "test_help" {
    tellraw @a [{"text":"=== Minecraft Pipes Test Commands ===","color":"gold","bold":true}];
    tellraw @a [{"text":"","color":"white"}];
    tellraw @a [{"text":"/function pipes:test_setup","color":"yellow"},{"text":" - Create simple pipe network","color":"white"}];
    tellraw @a [{"text":"/function pipes:test_setup_complex","color":"yellow"},{"text":" - Create complex branching network","color":"white"}];
    tellraw @a [{"text":"/function pipes:test_cleanup","color":"yellow"},{"text":" - Remove all test pipes and chests","color":"white"}];
    tellraw @a [{"text":"/function pipes:debug_pipe","color":"yellow"},{"text":" - Show pipe information","color":"white"}];
    tellraw @a [{"text":"","color":"white"}];
    tellraw @a [{"text":"=== How to Use ===","color":"gold","bold":true}];
    tellraw @a [{"text":"1. Run test_setup to create a pipe network","color":"white"}];
    tellraw @a [{"text":"2. Add items to the source chest","color":"white"}];
    tellraw @a [{"text":"3. Power the redstone block to start item flow","color":"white"}];
    tellraw @a [{"text":"4. Watch items travel through the pipes!","color":"white"}];
}
