namespace "pipes"

# ===== CONFIGURATION SYSTEM =====
function "init_config":
    # Initialize configuration system
    scoreboard objectives add pipes_config dummy
    scoreboard objectives add pipes_debug dummy
    scoreboard objectives add pipes_auto_extract dummy
    
    # Set default configuration values
    scoreboard players set #config pipes_flow_rate 20
    scoreboard players set #config pipes_token_speed 0.1
    scoreboard players set #config pipes_max_distance 500
    scoreboard players set #config pipes_auto_extract 1
    scoreboard players set #config pipes_debug 0
    scoreboard players set #config pipes_energy_enabled 0
    scoreboard players set #config pipes_redstone_enabled 0
    scoreboard players set #config pipes_priority_enabled 0

# ===== CONFIGURATION COMMANDS =====
function "config_help":
    tellraw @s [{"text":"=== PIPE CONFIGURATION ===","color":"gold"}]
    tellraw @s [{"text":"/function pipes:set_flow_rate <ticks> - Set item spawn rate","color":"aqua"}]
    tellraw @s [{"text":"/function pipes:set_token_speed <speed> - Set token movement speed","color":"aqua"}]
    tellraw @s [{"text":"/function pipes:set_max_distance <blocks> - Set max pipe distance","color":"aqua"}]
    tellraw @s [{"text":"/function pipes:toggle_auto_extract - Toggle automatic item extraction","color":"aqua"}]
    tellraw @s [{"text":"/function pipes:toggle_debug - Toggle debug mode","color":"yellow"}]
    tellraw @s [{"text":"/function pipes:toggle_energy - Toggle energy system","color":"yellow"}]
    tellraw @s [{"text":"/function pipes:toggle_redstone - Toggle redstone control","color":"yellow"}]
    tellraw @s [{"text":"/function pipes:toggle_priority - Toggle priority system","color":"yellow"}]
    tellraw @s [{"text":"/function pipes:show_config - Show current configuration","color":"green"}]

function "set_token_speed":
    # Set the movement speed of pipe tokens
    scoreboard players set #config pipes_token_speed 0.1
    tellraw @s [{"text":"[PIPES] Token speed set to 0.1 blocks/tick","color":"aqua"}]

function "set_max_distance":
    # Set the maximum distance for pipe connections
    scoreboard players set #config pipes_max_distance 500
    tellraw @s [{"text":"[PIPES] Max distance set to 500 blocks","color":"aqua"}]

function "toggle_auto_extract":
    # Toggle automatic item extraction from containers
    if "score #config pipes_auto_extract = 1":
        scoreboard players set #config pipes_auto_extract 0
        tellraw @s [{"text":"[PIPES] Auto-extract disabled","color":"red"}]
    else:
        scoreboard players set #config pipes_auto_extract 1
        tellraw @s [{"text":"[PIPES] Auto-extract enabled","color":"green"}]

function "toggle_debug":
    # Toggle debug mode for detailed logging
    if "score #config pipes_debug = 1":
        scoreboard players set #config pipes_debug 0
        tellraw @s [{"text":"[PIPES] Debug mode disabled","color":"yellow"}]
    else:
        scoreboard players set #config pipes_debug 1
        tellraw @s [{"text":"[PIPES] Debug mode enabled","color":"yellow"}]

function "toggle_energy":
    # Toggle energy system
    if "score #config pipes_energy_enabled = 1":
        scoreboard players set #config pipes_energy_enabled 0
        tellraw @s [{"text":"[PIPES] Energy system disabled","color":"red"}]
    else:
        scoreboard players set #config pipes_energy_enabled 1
        tellraw @s [{"text":"[PIPES] Energy system enabled","color":"green"}]

function "toggle_redstone":
    # Toggle redstone control system
    if "score #config pipes_redstone_enabled = 1":
        scoreboard players set #config pipes_redstone_enabled 0
        tellraw @s [{"text":"[PIPES] Redstone control disabled","color":"red"}]
    else:
        scoreboard players set #config pipes_redstone_enabled 1
        tellraw @s [{"text":"[PIPES] Redstone control enabled","color":"green"}]

function "toggle_priority":
    # Toggle priority system
    if "score #config pipes_priority_enabled = 1":
        scoreboard players set #config pipes_priority_enabled 0
        tellraw @s [{"text":"[PIPES] Priority system disabled","color":"red"}]
    else:
        scoreboard players set #config pipes_priority_enabled 1
        tellraw @s [{"text":"[PIPES] Priority system enabled","color":"green"}]

function "show_config":
    # Display current configuration
    tellraw @s [{"text":"=== CURRENT CONFIGURATION ===","color":"gold"}]
    tellraw @s [{"text":"Flow Rate: ","color":"aqua"},{"score":{"name":"#config","objective":"pipes_flow_rate"},"color":"white"},{"text":" ticks","color":"aqua"}]
    tellraw @s [{"text":"Token Speed: ","color":"aqua"},{"score":{"name":"#config","objective":"pipes_token_speed"},"color":"white"},{"text":" blocks/tick","color":"aqua"}]
    tellraw @s [{"text":"Max Distance: ","color":"aqua"},{"score":{"name":"#config","objective":"pipes_max_distance"},"color":"white"},{"text":" blocks","color":"aqua"}]
    
    if "score #config pipes_auto_extract = 1":
        tellraw @s [{"text":"Auto-extract: ","color":"aqua"},{"text":"ENABLED","color":"green"}]
    else:
        tellraw @s [{"text":"Auto-extract: ","color":"aqua"},{"text":"DISABLED","color":"red"}]
    
    if "score #config pipes_debug = 1":
        tellraw @s [{"text":"Debug Mode: ","color":"aqua"},{"text":"ENABLED","color":"yellow"}]
    else:
        tellraw @s [{"text":"Debug Mode: ","color":"aqua"},{"text":"DISABLED","color":"yellow"}]
    
    if "score #config pipes_energy_enabled = 1":
        tellraw @s [{"text":"Energy System: ","color":"aqua"},{"text":"ENABLED","color":"green"}]
    else:
        tellraw @s [{"text":"Energy System: ","color":"aqua"},{"text":"DISABLED","color":"red"}]
    
    if "score #config pipes_redstone_enabled = 1":
        tellraw @s [{"text":"Redstone Control: ","color":"aqua"},{"text":"ENABLED","color":"green"}]
    else:
        tellraw @s [{"text":"Redstone Control: ","color":"aqua"},{"text":"DISABLED","color":"red"}]
    
    if "score #config pipes_priority_enabled = 1":
        tellraw @s [{"text":"Priority System: ","color":"aqua"},{"text":"ENABLED","color":"green"}]
    else:
        tellraw @s [{"text":"Priority System: ","color":"aqua"},{"text":"DISABLED","color":"red"}]

# ===== CONFIGURATION APPLY FUNCTIONS =====
function "apply_config":
    # Apply configuration to running system
    if "score #config pipes_energy_enabled = 1":
        function pipes:init_advanced
    if "score #config pipes_debug = 1":
        tellraw @a [{"text":"[PIPES] Configuration applied","color":"green"}]

function "reset_config":
    # Reset configuration to defaults
    function pipes:init_config
    tellraw @s [{"text":"[PIPES] Configuration reset to defaults","color":"yellow"}]

# ===== DEBUG FUNCTIONS =====
function "debug_log":
    # Log debug information if debug mode is enabled
    if "score #config pipes_debug = 1":
        tellraw @a [{"text":"[PIPES DEBUG] ","color":"gray"},{"text":"Debug message","color":"white"}]

function "debug_show_entities":
    # Show all pipe entities for debugging
    if "score #config pipes_debug = 1":
        function pipes:list_connections
        tellraw @s [{"text":"[PIPES DEBUG] Showing all pipe entities","color":"gray"}]

# ===== PERFORMANCE OPTIMIZATION =====
function "optimize_performance":
    # Optimize pipe system performance
    scoreboard players set #config pipes_flow_rate 40
    scoreboard players set #config pipes_token_speed 0.2
    scoreboard players set #config pipes_max_distance 200
    tellraw @s [{"text":"[PIPES] Performance optimized for better FPS","color":"green"}]

function "high_performance":
    # Set high performance mode
    scoreboard players set #config pipes_flow_rate 60
    scoreboard players set #config pipes_token_speed 0.3
    scoreboard players set #config pipes_max_distance 100
    tellraw @s [{"text":"[PIPES] High performance mode enabled","color":"green"}]

function "low_performance":
    # Set low performance mode for older computers
    scoreboard players set #config pipes_flow_rate 80
    scoreboard players set #config pipes_token_speed 0.05
    scoreboard players set #config pipes_max_distance 50
    tellraw @s [{"text":"[PIPES] Low performance mode enabled","color":"yellow"}]
